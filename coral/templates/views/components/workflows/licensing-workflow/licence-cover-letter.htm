{% load i18n %}

<!-- ko if: loading() === false -->
<div style="display: flex; flex-direction: row">
  <div class="card-component" style="width: 100%">
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'domain-radio-widget',
          node: {
            'config': {
              'options': templateOptions,
            },
          },
          params: {
            node: {
            'config': {
              'options': templateOptions,
              },
              'configKeys': configKeys
            },
            config: {
              'label': 'Selected Template',
              'options': templateOptions,
            },
            value: template,
            loading: loading,
            form: $data,
            pageVm: $root
          }
      }"
      ></div>
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
              config: {
                  'label': 'Recipient Name',
              },
              value: coverLetterData.recipientName,
              loading: loading,
              form: $data,
              pageVm: $root
          }
      }"
      ></div>
      <div
        data-bind="component: {
          name: 'domain-radio-widget',
          node: {
            'config': {
              'options': addressOptions,
            },
          },
          params: {
            node: {
            'config': {
              'options': addressOptions,
              },
              'configKeys': configKeys
            },
            config: {
              'label': 'Selected Address',
              'options': addressOptions,
            },
            value: coverLetterData.selectedAddress,
            loading: loading,
            form: $data,
            pageVm: $root
          }
      }"
      ></div>

      <!-- ko if: contacts_loaded -->

      <div data-bind="if: selectedAddress() === 'Applicant'">
        <div
          data-bind="component: {
          name: 'domain-select-widget',
          node: {
            'config': {
              'options': applicantList,
              'multiple': true
            },
          },
          params: {
            node: {
            'config': {
              'options': applicantList,
              'multiple': true
              },
              'configKeys': configKeys
            },
            config: {
              'label': 'Recipient Name',
              'options': applicantList,
              'multiple': true
            },
            value: applicantText,
            loading: loading,
            form: $data,
            pageVm: $root
          }
      }"
        ></div>

        <div
          data-bind="component: {
        name: 'domain-select-widget',
        node: {
          'config': {
            'options': applicantAddresses,
          },
        },
        params: {
          node: {
          'config': {
            'options': applicantAddresses,
            },
            'configKeys': configKeys
          },
          config: {
            'label': 'Recipient Address',
            'options': applicantAddresses,
          },
          value: tempAddText,
          loading: loading,
          form: $data,
          pageVm: $root
        }
    }"
        ></div>
      </div>

      <div data-bind="if: selectedAddress() === 'Company'">
        <div
          data-bind="component: {
      name: 'domain-select-widget',
      node: {
        'config': {
          'options': companyList,
        },
      },
      params: {
        node: {
        'config': {
          'options': companyList,
          },
          'configKeys': configKeys
        },
        config: {
          'label': 'Company Name',
          'options': companyList,
        },
        value: companyText,
        loading: loading,
        form: $data,
        pageVm: $root
      }
  }"
        ></div>

        <div
          data-bind="component: {
    name: 'domain-select-widget',
    node: {
      'config': {
        'options': companyAddresses,
      },
    },
    params: {
      node: {
      'config': {
        'options': companyAddresses,
        },
        'configKeys': configKeys
      },
      config: {
        'label': 'Company Address',
        'options': companyAddresses,
      },
      value: tempAddText,
      loading: loading,
      form: $data,
      pageVm: $root
    }
}"
        ></div>
      </div>
      <!-- /ko -->
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
            name: 'text-widget',
            params: {
                config: {
                    'label': 'Site Name',
                },
                value: coverLetterData.siteName,
                loading: loading,
                form: $data,
                pageVm: $root
            }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
        name: 'datepicker-widget',
        params: {
            node: {
                config: {
                    'dateFormat': 'DD-MM-YYYY',
                },
            },
            config: {
                'label': 'Recieved Date',
                'maxDate': '',
                'minDate': '',
                'viewMode': 'days',
                'dateFormat': 'DD-MM-YYYY',
                'defaultValue': ''
            },
            value: coverLetterData.dates.received,
            loading: loading,
            form: $data,
            pageVm: $root
        }
      }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
        name: 'datepicker-widget',
        params: {
            node: {
                config: {
                    'dateFormat': 'DD-MM-YYYY',
                },
            },
            config: {
                'label': 'Acknowledged Date',
                'maxDate': '',
                'minDate': '',
                'viewMode': 'days',
                'dateFormat': 'DD-MM-YYYY',
                'defaultValue': ''
            },
            value: coverLetterData.dates.acknowledged,
            loading: loading,
            form: $data,
            pageVm: $root
        }
      }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
        name: 'datepicker-widget',
        params: {
            node: {
                config: {
                    'dateFormat': 'DD-MM-YYYY',
                },
            },
            config: {
                'label': 'Send Date',
                'maxDate': '',
                'minDate': '',
                'viewMode': 'days',
                'dateFormat': 'DD-MM-YYYY',
                'defaultValue': ''
            },
            value: coverLetterData.dates.sendDate,
            loading: loading,
            form: $data,
            pageVm: $root
        }
      }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: { 
            config: {
                'label': 'Building Name',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].buildingName,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Street',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].streetName,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Building Number',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].buildingNumber,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Building Number Sub Street',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].buildingNumberSubSt,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Sub Street',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].subStreet,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Town or City',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].city,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'County',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].county,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Postcode',
            },
            value: coverLetterData.addresses[coverLetterData.selectedAddress()].postcode,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Signed',
            },
            value: coverLetterData.decisionBy.name,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'text-widget',
          params: {
            config: {
                'label': 'Senior Inspector',
            },
            value: coverLetterData.seniorInspectorName,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <!-- ko if: textReady -->
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'rich-text-widget',
          params: {
            config: {
                'label': 'Text contents',
            },
            value: textBody,
            displayfullvalue: true,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
    </div>
    <!-- /ko -->
  </div>
  <div class="card-component" style="width: 100%">
    <div class="row widget-wrapper">
      <div
        data-bind="component: {
          name: 'cover-letter-widget',
          params: {
            config: {
              'label': 'Cover Letter',
            },
            coverLetterHtml: letter,
            loading: loading,
            form: $data,
            pageVm: $root
          }
        }"
      ></div>
      {% comment %}
      <div style="border: 5px solid black; padding: 10px; max-width: 500px; width: 100%">
        <!-- HEADER -->
        <div style="display: flex; align-items: end; width: 100%; flex-direction: column">
          <div>
            <!-- ko if: buildingName()[currentLanguage().code].value -->
            <span data-bind="text: buildingName()[currentLanguage().code].value"></span>
            <!-- /ko -->
            <!-- ko if: buildingName()[currentLanguage().code].value && buildingNumber()[currentLanguage().code].value -->
            <span>, </span>
            <!-- /ko -->
            <!-- ko if: buildingNumber()[currentLanguage().code].value -->
            <span data-bind="text: buildingNumber()[currentLanguage().code].value"></span>
            <!-- /ko -->
            <!-- ko if: buildingNumber()[currentLanguage().code].value && buildingNumberSubSt()[currentLanguage().code].value -->
            <span>, </span>
            <!-- /ko -->
            <!-- ko if: buildingNumberSubSt()[currentLanguage().code].value -->
            <span data-bind="text: buildingNumberSubSt()[currentLanguage().code].value"></span>
            <!-- /ko -->
          </div>
          <div>
            <!-- ko if: street()[currentLanguage().code].value -->
            <span data-bind="text: street()[currentLanguage().code].value"></span>
            <!-- /ko -->
            <!-- ko if: street()[currentLanguage().code].value && subStreet()[currentLanguage().code].value -->
            <span>, </span>
            <!-- /ko -->
            <!-- ko if: subStreet()[currentLanguage().code].value -->
            <span data-bind="text: subStreet()[currentLanguage().code].value"></span>
            <!-- /ko -->
          </div>
          <!-- ko if: city()[currentLanguage().code].value -->
          <span data-bind="text: city()[currentLanguage().code].value"></span>
          <!-- /ko -->
          <!-- ko if: county()[currentLanguage().code].value -->
          <span data-bind="text: county()[currentLanguage().code].value"></span>
          <!-- /ko -->
          <!-- ko if: postCode()[currentLanguage().code].value -->
          <span data-bind="text: getTextValue(postCode)"></span>
          <!-- /ko -->
        </div>
        <!-- DETAILS -->
        <div style="display: flex; width: 100%; flex-direction: column">
          <!-- ko if: sendDate() -->
          <span data-bind="text: 'Date: ' + sendDate()"></span>
          <!-- /ko -->
          <!-- ko if: getTextValue(bFileNumber) -->
          <span data-bind="text: 'Our ref: ' + getTextValue(bFileNumber)"></span>
          <!-- /ko -->
          <!-- ko if: getTextValue(areaName) -->
          <span data-bind="text: 'Site: ' + getTextValue(areaName)"></span>
          <!-- /ko -->
          <!-- ko if: getTextValue(licenceNo) -->
          <span data-bind="text: 'Licence No: ' + getTextValue(licenceNo)"></span>
          <!-- /ko -->
        </div>
        <!-- BODY -->
        <div style="display: flex; width: 100%; flex-direction: column; margin: 24px 0 16px 0">
          <!-- ko if: getTextValue(applicant) -->
          <span data-bind="text: '`Dear, ${getTextValue(applicant)}, ${company}`"></span>
          <!-- /ko -->
          <span
            data-bind="html: textPreview || 'Please enter information regarding the email!!'"
            style="margin-top: 8px"
          ></span>
        </div>
        <!-- FOOTER -->
        <div style="display: flex; width: 100%; flex-direction: column">
          
          <span
            data-bind="text: 'Yours sincerely \n ' + (getTextValue(signed) || 'Signature required!')"
          ></span>
          <!-- ko if: getTextValue(seniorInspector) -->
          <span>pp</span>
          <span data-bind="text: 'Senior Inspector: ' + getTextValue(seniorInspector)"></span>
          <!-- /ko -->
        </div>
      </div>
      {% endcomment %}
    </div>
  </div>
</div>
<!-- /ko -->
